<script>
async function handleLogin(ev){
  ev.preventDefault();
  const u = document.getElementById('user').value.trim();
  const p = document.getElementById('pass').value;

  try {
    const res = await api('login', { username: u, password: p });
    if (!res || !res.ok) throw new Error(res && res.error || 'เข้าสู่ระบบไม่สำเร็จ');

    const t = res.data && res.data.token;
    if (!t) throw new Error('ไม่พบ token จากเซิร์ฟเวอร์');

    setToken(t);
    // เก็บ session สำหรับเมนู/ส่วนหัว
    setSession({ user: res.data.user, role: res.data.role, fullname: res.data.user });

    window.location.href = 'home.html';
  } catch (e) { alert(e.message || String(e)); }
}
</script>



<div class="login-wrap">
  <div class="center"><div class="brand"><span class="material-symbols-outlined">qr_code_scanner</span> Equip Manager V2.3</div><p class="small">เข้าสู่ระบบ</p></div>
  <form onsubmit="handleLogin(event)">
    <div class="input"><label>ผู้ใช้</label><input id="user" required></div>
    <div class="input"><label>รหัสผ่าน</label><input id="pass" type="password" required></div>
    <div style="margin-top:12px;display:flex;gap:8px;"><button class="btn primary" type="submit">Login</button></div>
  </form>
</div>
</body></html>
