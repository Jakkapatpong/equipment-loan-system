<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>พิมพ์ QR | Equip V2.3</title>
  <link href="assets/style.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
  <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>
  <script src="js/config.js"></script>
  <script src="js/app.js"></script>
  <script src="js/sidebar.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      requireLogin(['admin','dev']);
      renderSidebar();
      const sel = document.getElementById('equipSelect');
      const res = await api('equip_list_for_select');
      if (res.ok && Array.isArray(res.data)) {
        sel.innerHTML = res.data.map(x => `<option value="${x.id}">${x.name} (${x.id})</option>`).join('');
      } else {
        alert(res.error || 'โหลดรายการอุปกรณ์ไม่สำเร็จ');
      }
    });
    async function renderQR(){
      const id = document.getElementById('equipSelect').value;
      const canvas = document.getElementById('qrCanvas');
      const payload = JSON.stringify({ type:'EQUIP', id:id });
      await QRCode.toCanvas(canvas, payload, { width: 256, margin: 2 });
      document.getElementById('qrPreviewText').textContent = payload;
    }
    function doPrint(){ window.print(); }
  </script>
  <style>@media print{ .topbar,.sidebar,.btn,.input,select,#qrPreviewText{display:none!important} .qr-box{border:none} body{background:#fff} }</style>
</head>
<body class="ui-v2 light">
<div class="container">
  <aside class="sidebar"></aside>
  <main class="main">
    <div class="topbar">
      <div class="left">
        <button class="btn hamburger"><span class="material-symbols-outlined">menu</span></button>
        <strong>พิมพ์ QR</strong>
      </div>
      <div class="user-info">...</div>
    </div>

    <div class="content">
      <div class="card">
        <div class="controls">
          <div class="input">
            <label>เลือกอุปกรณ์จากรายการ</label>
            <select id="equipSelect"></select>
          </div>
          <div class="actions" style="justify-content:flex-end;align-self:end">
            <button class="btn" onclick="renderQR()">แสดง QR</button>
          </div>
        </div>
      </div>

      <div class="qr-grid">
        <div></div>
        <div class="qr-box">
          <canvas id="qrCanvas" width="256" height="256"></canvas>
          <div class="badge info" id="qrPreviewText" style="margin-top:10px">ตัวอย่าง QR Code</div>
          <div style="margin-top:12px"><button class="btn primary" onclick="doPrint()"><span class="material-symbols-outlined">print</span> พิมพ์</button></div>
        </div>
        <div></div>
      </div>
    </div>
  </main>
</div>
</body>
</html>
