async function toB64(f,maxW=1280,maxH=1280,q=0.82){return new Promise((res,rej)=>{const i=new Image(),r=new FileReader();r.onload=e=>{i.onload=()=>{const t=Math.min(maxW/i.width,maxH/i.height,1),c=document.createElement('canvas');c.width=Math.round(i.width*t);c.height=Math.round(i.height*t);c.getContext('2d').drawImage(i,0,0,c.width,c.height);res(c.toDataURL('image/jpeg',q))};i.src=e.target.result};r.onerror=rej;r.readAsDataURL(f)})}
document.getElementById('f').addEventListener('submit', async (e)=>{e.preventDefault();const name=document.getElementById('name').value.trim();const price=document.getElementById('price').value;const purchaseDate=document.getElementById('pdate').value;const f=document.getElementById('img').files[0];let b64='';if(f){b64=await toB64(f)}try{const d=await api('addEquipment',{payload:{name,price,purchaseDate,imageBase64:b64}});alert('เพิ่มอุปกรณ์สำเร็จ');document.getElementById('qrLink').href=d.qr_url;document.getElementById('qrResult').style.display='block';e.target.reset();}catch(err){alert(err.message)}});
